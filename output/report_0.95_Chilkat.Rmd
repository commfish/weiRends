---
title: "1% Weir Escapement Rule" 
subtitle: "Chilkat Lake Sockeye Salmon"
author: "Sara Miller and Steve Heinl"
date: "February 14, 2022"
output:
  bookdown::pdf_document2:
    fig_caption: yes
    toc: yes
header-includes:
 \usepackage{float}
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message = FALSE, 
                      error=FALSE, fig.pos = 'H', out.width = '95%')
```

```{r load}
library(here)
library(fs)
library(tidyverse)
library(knitr)
```

```{r data}
fs::dir_ls(here::here('output/chilkat/1971_2021/global_missfill'), regexp = "\\.csv$") %>% 
  set_names(nm = (basename(.) %>% 
                    tools::file_path_sans_ext())) %>%
  map(read_csv) -> tbls_chilkat_global_missfill
fs::dir_ls(here::here('output/chilkat/2012_2021/global_missfill'), regexp = "\\.csv$") %>% 
  set_names(nm = (basename(.) %>% 
                    tools::file_path_sans_ext())) %>%
  map(read_csv) -> tbls_chilkat_ten_years_global_missfill
fs::dir_ls(here::here('output/chilkat/1971_2021/gompertz'), regexp = "\\.csv$") %>% 
  set_names(nm = (basename(.) %>% 
                    tools::file_path_sans_ext())) %>%
  map(read_csv) -> tbls_chilkat_gompertz
fs::dir_ls(here::here('output/chilkat/2012_2021/gompertz'), regexp = "\\.csv$") %>% 
  set_names(nm = (basename(.) %>% 
                    tools::file_path_sans_ext())) %>%
  map(read_csv) -> tbls_chilkat_ten_years_gompertz

```


# Background
There were two objectives in this study.

  1. The first objective was to quantify the date to which the weir would be required to be operated through (e.g., would capture 95% of the escapement with 95% probability; the hard date). The earliest date a project can end is the day after the hard date. 
  
  2. The second objective was to estimate the percent of counts missed if the project was operated following the $x$-day 1% rule (daily counts equal less than 1% of the cumulative count for $x$ days (1, 2, 3, 4, or 5 days) in a row up to and including the hard date). For example, if the hard date is Julian day 247 and days 243 to 247 are <1% of the cumulative counts for 5 days, then the end date for that year would be Julian day 248.   

All associated files, data, and code are located at https://github.com/commfish/weiRends. This work is based upon efforts originally developed by Scott Raborn. The code was originally written by Ben Williams and then adapted by Sara Miller. The code for the EM algorithm was developed by Justin Priest.


## Definitions
*Hard date*: The escapement date that captures 95% of the escapement with 95% probability. The date to which the weir would be required to be operated through. 

*End date*: The end date is the estimated day the weir project would have ended in the past if the 1% rule had been in place. The end date is expressed as the median date and as a range (end range) of dates (e.g., 25th–75th percentiles or minimum–maximum). The projected end date and end range can be used for planning purposes.  

# Data Inputs

The input data format is four columns with date (preferably in year-mm-dd format), weir count data, species, and year. 

An example is:  
  date      count   species  year  
2019-07-20    20    Sockeye  2019

This is for a single species at a single weir. 
No other values or comments should be included in the file. 
Data should be provided in .csv format. 

# Methods
Three methods were used to estimate tails of the escapement when weir operations did not capture the entire escapement, particularly the end of the escapement: the Gompertz model, the logistic model, and the Expectation-Maximization (EM) algorithm. Reconstructed tails of the escapement using the entire time series (1971-1995 and 1999-2021; the Chilkat Lake weir was not operated from 1996 to 1998) or the last ten years of the time series (2012-2021) are compared in the analysis. Reconstructed escapement was capped at the latest date for which Chilkat Lake weir observations are available (20 November).   

## Gompertz and logistic models
Two models were considered first:

the Gompertz model 
$$p\mathrm{e}^{{-e}^{-k(t-t_0)}},$$ 
and the logistic model 
$$\frac{p}{\mathrm{1+e}^{-k(t-t_0)}}.$$ 
The variable *p* represents the asymptote of the cumulative escapement, *k* is the steepness of the curve, and *t*~0~ is the inflection point of the curve. These models were used in 1% rule analysis for Bristol Bay and Upper Cook Inlet salmon stocks (Scott Raborn, pers. comm.). 

The evaluation process starts by fitting both models to the cumulative sum of the weir counts, and then the model with the least total variance (i.e., smallest deviance; residual sum of squares of the model) is chosen for the analysis. For each year modeled, the Gompertz model and logistic model are compared to determine the model with the lowest deviance. The model with a greater percentage of the modeled years (each year is modeled separately) with a lower deviance becomes the chosen model. For example, using the entire time series, 25 of the 48 modeled years (52%) based on the Gompertz model had a lower deviance than the logistic model. Therefore, the Gompertz model was the model used in the Chilkat Lake analysis. Cumulative escapement is predicted from the selected model and then this is converted into the number of estimated fish past the weir for a given day. A reconstructed escapement is estimated using observed daily data, filling in any data gaps with estimated daily escapement numbers. This reconstructed escapement is then used to compute a cumulative sum of escapement (Figure \@ref(fig:pred-chilkat-cumsums-gompertz)). The date that a weir should remain in place to capture the 95th percentile of 95% of the escapement is calculated using the reconstructed cumulative sums. Based on the model deviance, the Gompertz model provided an overall better fit to the data than the logistic model. Based on the Gompertz model, the models converged for all years, but year 2003 had substantial error bars for parameters $p$ and $t$ (Figure \@ref(fig:param-chilkat-gompertz)). Reconstructed escapements are shown in Figure \@ref(fig:pred-chilkat-gompertz).

```{r pred-chilkat-cumsums-gompertz, fig.cap="A. Raw and fitted cumulative sums of the weir counts by year (1971-1995; 1999-2021), based on the Gompertz model. B. Difference between the raw and fitted cumulative sums of the weir counts by year. The difference between the raw and fitted cumulative sums is the reconstructed tails."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/fitted_plot.png"))
```

```{r param-chilkat-gompertz, fig.cap="Parameter estimates from the Gompertz model for Chilkat Lake sockeye salmon (1971-1995; 1999-2021). The year 2003 has substantial error bars for parameters p and t."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/param_plot.png"))
```

```{r pred-chilkat-gompertz, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the Gompertz model (1971-1995; 1999-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 17 November or Julian day 321). The circles are the cumulative escapement data and the lines are the predicted cumulative escapement."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/pred_plot.png"))
```

## Expectation-maximization (EM) algorithm
A third method was used to reconstruct escapement using observed historical data to fill data gaps with estimated daily escapement numbers using an iterative procedure (EM algorithm; McLachlan and Krishnan 1997). Missing values of the escapement were filled in under the assumption that the expected count is determined by a given year and Julian day in a multiplicative way. The estimated count for a given Julian day in a given year is equal to the sum of all counts for the particular Julian day times the sum of all counts for the year divided by the sum of all counts over all Julian days and years. If there is more than one missing value, an iterative procedure (as described in Brown 1974) is used since the sums change as missing values are filled in at each step. Reconstructed escapement is then used to compute a cumulative sum of escapement (Figure \@ref(fig:pred-chilkat-cumsums-global-missfill)). The date that a weir should remain in place to capture the 95th percentile of 95% of the escapement is calculated using the reconstructed cumulative sums. This method requires observed data as late as possible into the season. Reconstructed escapements are shown in Figure \@ref(fig:pred-chilkat-global-missfill).

```{r pred-chilkat-cumsums-global-missfill, fig.cap="A. Raw and fitted cumulative sums of the weir counts by year (1971-1995; 1999-2021), based on the EM algorithm. B. Difference between the raw and fitted cumulative sums of the weir counts by year. The difference between the raw and fitted cumulative sums is the reconstructed tails."}
knitr::include_graphics(here("figs/chilkat/1971_2021/global_missfill/fitted_plot.png"))
```

```{r pred-chilkat-global-missfill, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the EM algorithm (1971-1995; 1999-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 15 October or Julian day 288). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/1971_2021/global_missfill/pred_plot.png"))
```

# Results
## 1% Rule (*Hard Date* and *End Date*)

### Gompertz Model (2012-2021)
Using the last ten years of the time series (2012-2021), the 95th percentile date when 95% of the escapement has passed the weir  is Julian day `r tbls_chilkat_ten_years_gompertz$run_through$hard_date` or approximately 14 November (the hard date). The earliest date the project can end is Julian day 319 or approximately 15 November (Julian day `r tbls_chilkat_ten_years_gompertz$run_through$hard_date` plus one day). Based upon these dates, there is a 95% chance of capturing roughly 95% of the total escapement for the 3-day 1% escapement rule (Appendix A Table \@ref(tab:chance-chilkat-ten-years-gompertz)). In addition, there is a 50% chance of capturing about 97% of the escapement for the 3-day 1% weir removal rule (Appendix A Table \@ref(tab:chance-chilkat-ten-years-gompertz)). 

The projected median end date that the project would end is Julian day 319 (approximately 15 November) using the 3-day 1% weir removal rule (Appendix A Table \@ref(tab:remove-chilkat-ten-years-gompertz)). The project median end date was based on the last ten years of the time series (2012-2021) and estimates of when the weir would have been removed had the 1% rule been used to manage weir operations. The maximum date of weir removal is Julian day 319 (approximately 15 November) using the 3-day 1% weir removal rule (Appendix A Table \@ref(tab:remove-chilkat-ten-years-gompertz)). 


### Gompertz Model (1971-1995; 1999-2021)
If the entire time series (1971-1995; 1999-2021) is used for the analysis, the hard date is extended by 3 days (see Appendix A Table \@ref(tab:chance-chilkat-gompertz); Table \@ref(tab:remove-chilkat-gompertz); Figures \@ref(fig:pred-chilkat-1990-gompertz) to \@ref(fig:pred-chilkat-2021-gompertz)); the 95th percentile date when 95% of the escapement has passed the weir is Julian day `r tbls_chilkat_gompertz$run_through$hard_date` or approximately 17 November (the hard date). The earliest date the project can end is Julian day 322 or 18 November (Julian day `r tbls_chilkat_gompertz$run_through$hard_date` plus one day). Based upon these dates, there is a 95% chance of capturing roughly 98% of the total escapement for the 3-day 1% weir removal rule (Table \@ref(tab:chance-chilkat-gompertz)). In addition, there is a 50% chance of capturing about 99% of the escapement for the 3-day 1% weir removal rule (Table \@ref(tab:chance-chilkat-gompertz)). 

The projected median end date that the project would end, based on the entire time series, is Julian day 322 (approximately 18 November) for all weir removal rules (Appendix A Table \@ref(tab:remove-chilkat-gompertz)). Based on the Gompertz model, year 2003 had substantial error bars (Figure \@ref(fig:param-chilkat-gompertz)) for parameters $p$ and $t$. If the entire time series is used, the year 2003 needs to be investigated further and may need to be removed as an outlier.

### EM Algorithm (2012-2021)
Using the last ten years of the time series (2012-2021; Appendix B Figure \@ref(fig:pred-chilkat-cumsums-ten-years-global-missfill)), the 95th percentile date when 95% of the escapement has passed the weir is Julian day `r tbls_chilkat_ten_years_global_missfill$run_through$hard_date` or approximately 11 October (the hard date). The earliest date the project can end is is Julian day 285 or approximately 12 October (Julian day `r tbls_chilkat_ten_years_global_missfill$run_through$hard_date` plus one day). Based upon these dates, there is a 95% chance of capturing at least 95% of the total escapement for the 3-day 1% weir removal rule (Table \@ref(tab:chance-chilkat-ten-years-global-missfill)). In addition, there is a 50% chance of capturing about 95% of the escapement for the 3-day 1% weir removal rule (Table \@ref(tab:chance-chilkat-ten-years-global-missfill)). 

The projected median end date that the project would end is Julian day 285 (approximately 12 October) for the 3-day 1% weir removal rule (Table \@ref(tab:remove-chilkat-ten-years-global-missfill)). The project median end date was based on the last ten years of the time series (2012-2021) and estimates of when the weir would have been removed had the 1% rule been used to manage weir operations. The maximum date of weir removal was Julian day 292 (approximately 19 October) using the 3-day 1% weir removal rule (Table \@ref(tab:remove-chilkat-ten-years-global-missfill)). 

```{r chance-chilkat-ten-years-global-missfill, results = 'asis'}
tbls_chilkat_ten_years_global_missfill$remove_dates_run_caught %>% 
   knitr::kable(format = 'pandoc', caption = 'The percent of the escapement that is observed at a given risk level (% chance) based upon the number of days the 1% rule is implemented for the Chilkat Lake sockeye salmon based on the EM algorithm (2012-2021).')
```

```{r remove-chilkat-ten-years-global-missfill, results = 'asis'}
tbls_chilkat_ten_years_global_missfill$remove_dates_median_end %>% 
   knitr::kable(format = 'pandoc', caption = 'Median and maximum end dates for weir removal based upon number of days to implement the 1% rule for the Chilkat Lake sockeye salmon based on the EM algorithm (2012-2021).')
```

### EM Algorithm (1971-1995; 1999-2021)
If the entire time series (1971-1995; 1999-2021) is used for the analysis, the hard date is extended by just 4 days (Table \@ref(tab:chance-chilkat-global-missfill); Table \@ref(tab:remove-chilkat-global-missfill); Figure \@ref(fig:pred-chilkat-cumsums-global-missfill); Figure \@ref(fig:pred-chilkat-global-missfill)); the 95th percentile date when 95% of the escapement has passed the weir is Julian day `r tbls_chilkat_global_missfill$run_through$hard_date` or approximately 15 October (the hard date). The earliest date the project can end is Julian day 289 or 16 October (Julian day `r tbls_chilkat_global_missfill$run_through$hard_date` plus one day). Based upon these dates, there is a 95% chance of capturing almost 96% of the total escapement for the 3-day 1% weir removal rule (Table \@ref(tab:chance-chilkat-global-missfill)). In addition, there is a 50% chance of capturing about 96% of the escapement for the 3-day 1% weir removal rule (Table \@ref(tab:chance-chilkat-global-missfill)). 

The projected median end date that the project would end, based on the entire time series, is Julian day 289 (approximately 16 October) for the 3-day 1% weir removal rule (Table \@ref(tab:remove-chilkat-global-missfill)). The maximum date of weir removal was Julian day 297 (approximately 24 October) using the 3-day 1% weir removal rule (Table \@ref(tab:remove-chilkat-global-missfill)). 

```{r chance-chilkat-global-missfill, results = 'asis'}
tbls_chilkat_global_missfill$remove_dates_run_caught %>% 
   knitr::kable(format = 'pandoc', caption = 'The percent of the escapement that is observed at a given risk level (% chance) based upon the number of days the 1% rule is implemented for Chilkat Lake sockeye salmon based on the EM algorithm (1971-1995; 1999-2021).')
```

```{r remove-chilkat-global-missfill, results = 'asis'}
tbls_chilkat_global_missfill$remove_dates_median_end %>% 
   knitr::kable(format = 'pandoc', caption = 'Median and maximum end dates for weir removal based upon number of days to implement the 1% rule for the Chilkat Lake based on the EM algorithm (1971-1995; 1999-2021).')
```

# Discussion
Each of the methods used to estimate Chilkat Lake sockeye salmon escapement tails have issues that must be considered. The drawbacks in using the Gompertz and logistic models are that escapement tails may be overestimated, and results may be affected by the parameters set for the model. For example, one of the model inputs is how far out in time the lengths of the tails are to be estimated. This can be set as the latest date of observed fish counts (as in this case; 20 November), 10 days after that date (the method used for Bristol Bay stocks), or any other chosen date. Based on the entire time series, the difference between the cumulative raw counts of Chilkat Lake sockeye salmon and the estimated counts using the Gompertz model averaged 34,400 fish (42%) and ranged from 14 fish (0%) to 218,000 fish (189%) (Figure \@ref(fig:pred-chilkat-cumsums-gompertz)), whereas the difference between the cumulative raw counts and the estimated counts using the EM algorithm averaged only 4,500 fish (6%) and ranged from 33 fish (0%) to 26,000 fish (19%) (Figure \@ref(fig:pred-chilkat-cumsums-global-missfill)). Estimated escapement tails were consistently larger using the Gompertz model and in many instances extended well beyond what would appear to be reasonable dates for the Chilkat Lake sockeye salmon run (Figure \@ref(fig:pred-chilkat-gompertz) and Figures \@ref(fig:pred-chilkat-ten-years-gompertz) to \@ref(fig:pred-chilkat-2021-gompertz)). As a result, based on the entire time series, the estimated hard date using the Gompertz model was an unrealistic Julian day `r tbls_chilkat_gompertz$run_through$hard_date` or approximately 17 November,  33 days later than the hard date estimated from the EM algorithm (Julian day `r tbls_chilkat_global_missfill$run_through$hard_date` or approximately 15 October). Likewise, based on the last ten years of the time series, the estimated hard date using the Gompertz model was an unrealistic Julian day `r tbls_chilkat_ten_years_gompertz$run_through$hard_date` or approximately 14 November, 34 days later than the hard date estimated from the EM algorithm (Julian day `r tbls_chilkat_ten_years_global_missfill$run_through$hard_date` or approximately 11 October). The EM algorithm can also present issues, including the requirement of a lot of observations late in the season and inability to account for changes in run timing without recent years of late-season weir operations to include in the analysis. Weir operations at Chilkat Lake have been conducted to 1 November in 17% (8 of 48) of years and to at least 25 October in 25% (12 of 48) of years (all prior to 2000). Given the potential for the Gompertz model to overestimate the escapement tails and the unrealistic hard date estimated by the model, we recommend using the EM algorithm results, based on the entire time series, to implement a 3-day 1% weir removal rule for Chilkat Lake sockeye salmon weir operation.


# Conclusions
  1. The hard date, the date to which the Chilkat Lake sockeye salmon weir must be operated through, is Julian day `r tbls_chilkat_global_missfill$run_through$hard_date` (approximately 15 October), based on escapements estimated from the EM algorithm using the entire escapement time series.  
  
  2. The estimated median weir removal date (end date) was Julian day 289 (approximately 16 October) and the maximum weir removal date was Julian day 297 (approximately 24 October) using the 3-day 1% weir removal rule for the Chilkat Lake sockeye salmon weir, based on escapements estimated from the EM algorithm using the entire escapement time series.
  
# References
Brown, M. B. 1974. Identification of sources of significance in two-way contingency tables. Applied statistics 23:405-413. 

McLachlan, G. J. and T. Krishnan. 1997. The EM algorithm and extensions. John Wiley and Sons. New York.
  
# Appendix A  
## Gompertz Model (2012-2021)
```{r pred-chilkat-cumsums-gompertz-ten-years, fig.cap="A. Raw and fitted cumulative sums of the weir counts by year (2012-2021), based on the Gompertz model. B. Difference between the raw and fitted cumulative sums of the weir counts by year. The difference between the raw and fitted cumulative sums is the reconstructed tails."}
knitr::include_graphics(here("figs/chilkat/2012_2021/gompertz/fitted_plot.png"))
```


```{r param-chilkat-ten-years-gompertz, fig.cap="Parameter estimates from the Gompertz model for Chilkat Lake sockeye salmon (2012-2021)."}
knitr::include_graphics(here("figs/chilkat/2012_2021/gompertz/param_plot.png"))
```

```{r pred-chilkat-ten-years-gompertz, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon using the Gompertz model (2012-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 14 November or Julian day 318). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/2012_2021/gompertz/pred_plot.png"))
```

```{r chance-chilkat-ten-years-gompertz, results = 'asis'}
tbls_chilkat_ten_years_gompertz$remove_dates_run_caught %>% 
   knitr::kable(format = 'pandoc', caption = 'The percent of the escapement that is observed at a given risk level (% chance) based upon the number of days the 1% rule is implemented for the Chilkat Lake sockeye salmon based on the Gompertz model (2012-2021).')
```

```{r remove-chilkat-ten-years-gompertz, results = 'asis'}
tbls_chilkat_ten_years_gompertz$remove_dates_median_end %>% 
   knitr::kable(format = 'pandoc', caption = 'Median and maximum end dates for weir removal based upon number of days to implement the 1% rule for the Chilkat Lake sockeye salmon based on the Gompertz model (2012-2021).')
```


## Gompertz Model (1971-1995; 1999-2021)
```{r chance-chilkat-gompertz, results = 'asis'}
tbls_chilkat_gompertz$remove_dates_run_caught %>% 
   knitr::kable(format = 'pandoc', caption = 'The percent of the escapement that is observed at a given risk level (% chance) based upon the number of days the 1% rule is implemented for Chilkat Lake sockeye salmon based on the Gompertz model (1971-1995; 1999-2021).')
```

```{r remove-chilkat-gompertz, results = 'asis'}
tbls_chilkat_gompertz$remove_dates_median_end %>% 
   knitr::kable(format = 'pandoc', caption = 'Median and maximum end dates for weir removal based upon number of days to implement the 1% rule for the Chilkat Lake based on the Gompertz model (1971-1995; 1999-2021).')
```

```{r pred-chilkat-1990-gompertz, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the Gompertz model (1971-1995; 1999-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 17 November or Julian day 321). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/pred_plot_1999year.png"))
```

```{r pred-chilkat-1991-gompertz, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the Gompertz model (1971-1995; 1999-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 17 November or Julian day 321). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/pred_plot_2000year.png"))
```

```{r pred-chilkat-2001-gompertz, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the Gompertz model (1971-1995; 1999-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 17 November or Julian day 321). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/pred_plot_2010year.png"))
```

```{r pred-chilkat-2021-gompertz, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the Gompertz model (1971-1995; 1999-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 17 November or Julian day 321). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/1971_2021/gompertz/pred_plot_2015year.png"))
```

# Appendix B 
## EM Algorithm (2012-2021)
```{r pred-chilkat-cumsums-ten-years-global-missfill, fig.cap="A. Raw and fitted cumulative sums of the weir counts by year (2012-2021), based on the EM algorithm. B. Difference between the raw and fitted cumulative sums of the weir counts by year. The difference between the raw and fitted cumulative sums is the reconstructed tails."}
knitr::include_graphics(here("figs/chilkat/2012_2021/global_missfill/fitted_plot.png"))
```

```{r pred-chilkat-ten-years-global-missfill, fig.cap="Predicted cumulative escapements by year for Chilkat Lake sockeye salmon based on the EM algorithm (2012-2021). Filled circles indicate 95\\% of the escapement has passed the weir. The vertical line is the 95th percentile date when 95\\% of the escapement has passed the weir. This is the hard date (approximately 11 October or Julian day 284). The circles are the cumulative escapement data and the lines are the predicted cumulative escapements."}
knitr::include_graphics(here("figs/chilkat/2012_2021/global_missfill/pred_plot.png"))
```
